Chapter3  modified for branching